---
title: "Storm Data - Code Book"
author: "Hugo van den Berg"
date: "August 21, 2016"
output: 
    github_document:
        toc: true
        toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = file.path(getwd(), '..'))
library(readr)
library(xtable)
library(magrittr)
library(tidyr)
```

## Introduction

This document describes the variables of the Storm Database, including
possible ranges.
As the original data seem to be poorly documented this code book describes
both the [original data](#original-data) as well as the 
[preprocessed data](#preprocessed-data).
Although with the preprocessed variables is described on what original 
variable(s) it is based, the exact transformation can be found in the
[main report](../reports/StormData.md)

Since it is an R Markdown based codebook, this actually generates the
transformation files for factor variables used in the main report.

## Original data

### STATE__

`STATE__` is a numeric variable, ranging from [x1, x2].
Its meaning is unclear, it appears to be a numeric representation of the state
abbreviation (see [STATE](#state)).

### BGN_DATE

`BGN_DATE` is a date variable ranging from 1950-01-03 until 2011-11-30.
It describes the start date of a weather event in the local timezone (see
[TIME_ZONE](#time_zone)).
Note that the original file includes a time in this variable.
However this is 00:00:00 throughout the file and can be ignored, and the value
from the [BGN_TIME](#bgn_time) should be used instead.

### BGN_TIME

`BGN_TIME` is time variable containing the local time of day for the start of a
weather event.
It should be used together with [BGN_DATE](#bgn_date) and
[TIME_ZONE](#time_zone).

### TIME_ZONE

`TIME_ZONE` is a three letter code describing the timezone in which the event
occurred.

Timezones are inherently difficult to work with, and three letter POSIX codes
cannot be uniquely mapped to the Olson timezone names R uses.
Therefore the codes have been mapped manually to a suitable Olson timezone:

```{r tz, results='asis'}
source(file.path('doc', 'TZ.R'))
write_csv(TZ, file.path('data', 'TZ.csv'))
xTZ <- xtable(TZ)
names(xTZ) <- c("Time Zone", "State Code", "Olson/IANA Timezone")
print(xTZ, type = "html", include.rownames = FALSE,
      html.table.attributes = "")
```

*This table is available in [TZ.csv](../data/TZ.csv)*

### COUNTY

`COUNTY` is a numeric variable ranging from 0 to 873, describing the county in
which the weather event started.

### COUNTYNAME

`COUNTYNAME` is a character variable containing the county or counties in which
the event occurred.
It contains both references to county names and to county codes prepended with
the [state code](#state).

### STATE

`STATE` is a two-letter character variable containing an abbreviated state
name.
It contains 79 unique values, 50 of which can be related to the built in
`state.abb` variable.

Using the combination of state code and [countyname](#countyname) the meaning 
of the other 22 values was inferred.
Below is the ammended list of the used codes with their full description.

```{r state, results='asis'}
source(file.path('doc', 'STATE.R'))
write_csv(STATE, file.path('data', 'STATE.csv'))
xSTATE <- xtable(STATE)
names(xSTATE) <- c("State Code", "Region Name")
print(xSTATE, type = "html", include.rownames = FALSE,
      html.table.attributes = "")
```

*This table is available in [STATE.csv](../data/STATE.csv)*

### EVTYPE

`EVTYPE` is character variable containing the type of weather event that
occurred.
It contains 977 unique values (890 unique values ignoring upper/lower case),
ranging from "?" to "WND".

A large number of misspelled eventtypes was present.
The mapping below has been used to create uniform event types.

```{r evtype, results='asis'}
source(file.path('doc', 'EVTYPE.R'))
write_csv(EVTYPE, file.path('data', 'EVTYPE.csv'))
xEVTYPE <- xtable(EVTYPE)
names(xEVTYPE) <- c("Event type (original)", "Event type (unified)")
print(xEVTYPE, type = "html", include.rownames = FALSE,
      html.table.attributes = "")
```

*This table is available in [EVTYPE.csv](../data/EVTYPE.csv)*

### BGN_RANGE

`BGN_RANGE` is a numeric variable.
It contains 272 unique values ranging from 0 to 3749.

### BGN_AZI

`BGN_AZI` is a character variable describing the azimuth

### BGN_LOCATI

`BGN_LOCATI`

### END_DATE

`END_DATE`

### END_TIME

`END_TIME`

### COUNTY_END

`COUNTY_END`

### COUNTYENDN

`COUNTYENDN`

### END_RANGE

`END_RANGE`

### END_AZI

`END_AZI`

### END_LOCATI

`END_LOCATI`

### LENGTH

`LENGTH`

### WIDTH

`WIDTH`

### F

`F`

### MAG

`MAG`

### FATALITIES

`FATALITIES` fatalities

### INJURIES

`INJURIES` injuries

### PROPDMG

`PROPDMG` property damage

### PROPDMGEXP

`PROPDMGEXP` property damage expense magnitude

### CROPDMG

`CROPDMG` crop damage

### CROPDMGEXP

`CROPDMGEXP` crop damage expense magnitude

### WFO

`WFO`

### STATEOFFIC

`STATEOFFIC`

### ZONENAMES

`ZONENAMES`

### LATITUDE

`LATITUDE`

### LONGITUDE

`LONGITUDE`

### LATITUDE_E

`LATITUDE_E`

### LONGITUDE_

`LONGITUDE_`

### REMARKS

`REMARKS`

### REFNUM

`REFNUM`


## Preprocessed data

### event.type.major

```{r etma}
EVTYPE %<>% separate(to, c("event.type.major", "event.type.minor"),
                     sep = "/", extra = "merge", fill = "right", 
                     remove = FALSE)
```
`event.type.major` is a factor variable containing uniform event types,
based on the original [EVTYPE](#evtype) and the listed transformations.
They contain only the part before the first "/" in the original variable.
`event.type.major` contains `r length(unique(EVTYPE$event.type.major))`
unique values, ranging from "`r min(EVTYPE$event.type.major, na.rm = T)`" to 
"`r max(EVTYPE$event.type.major, na.rm = T)`".

### event.type.minor

`event.type.minor` is a factor variable containing the minor event types,
based on the original [EVTYPE](#evtype) and the listed transformations.
`event.type.minor` contains `r length(unique(EVTYPE$event.type.minor))`
unique values, ranging from "`r min(EVTYPE$event.type.minor, na.rm = T)`" to 
"`r max(EVTYPE$event.type.minor, na.rm = T)`".

### region

`region` is a factor variable containing the region in which the weather event
occurred.
For the most regions this is a state name, but several non-state regions have
been identified as well.
The data is based on the [STATE](#state) variable, see the corresponding
section for the mapping from state code to region name.

### begin.date

`begin.date` is a POSIXct object containing the date and time at the start of
the weather event.

### begin.county

### begin.latitude

### begin.longitude

### end.date

### end.county

### end.latitude

### end.longitude

### fatalities

### injuries

### property.damages

### crop.damages
